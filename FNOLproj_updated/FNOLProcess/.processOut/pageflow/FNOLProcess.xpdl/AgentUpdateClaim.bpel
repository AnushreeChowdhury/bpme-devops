<?xml version="1.0" encoding="UTF-8"?>
<bpws:process exitOnStandardFault="no" name="AgentUpdateClaim"
    suppressJoinFailure="yes" tibex:bxVersion="11.0.0"
    tibex:dataFieldDescriptorClass="com.example.fnolprocess.FNOLProcess.AgentUpdateClaim"
    tibex:dataFieldDescriptorScript="process-js/FNOLProcess/AgentUpdateClaim/AgentUpdateClaim.js"
    tibex:explicitCompensation="yes"
    tibex:xpdlId="_FMpc8POiEeuR8o7qyugDXg"
    xmlns:bpws="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:tibex="http://www.tibco.com/bpel/2007/extensions" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <tibex:VariableDescriptor type="PersistentBatching">
        <task name="_BX_SPOutput_GetPolicy">
            <startingVariables>
                <variable>PolicyRef</variable>
            </startingVariables>
        </task>
        <task name="DisplayandUpdateClaim">
            <startingVariables>
                <variable>Claim</variable>
            </startingVariables>
        </task>
        <task name="UpdateClaimDetailsOrAddCounterParty">
            <startingVariables>
                <variable>AddCounterparty</variable>
            </startingVariables>
        </task>
        <task name="_BX_SPInput_GetClaim">
            <startingVariables>
                <variable>PolicyRef</variable>
            </startingVariables>
        </task>
        <task name="_BX_SPOutput_FindPolicyHolder">
            <startingVariables>
                <variable>PolicyHolderRef</variable>
            </startingVariables>
        </task>
        <task name="_BX_SPInput_AddCounterParty">
            <startingVariables>
                <variable>claimRef</variable>
            </startingVariables>
        </task>
        <task name="_BX_SPOutput_GetClaim">
            <startingVariables>
                <variable>claimRef</variable>
                <variable>Claim</variable>
            </startingVariables>
        </task>
        <task name="UpdateClaim">
            <startingVariables>
                <variable>claimRef</variable>
                <variable>Claim</variable>
            </startingVariables>
        </task>
        <task name="_BX_SPInput_GetPolicy">
            <startingVariables>
                <variable>PolicyHolderRef</variable>
            </startingVariables>
        </task>
    </tibex:VariableDescriptor>
    <bpws:documentation>*** Generated by TIBCO Business Studio.</bpws:documentation>
    <bpws:variables>
        <bpws:variable name="PolicyHolderRefs" tibex:array="yes"
            tibex:classRef="com.fnoldata.Policyholder" tibex:xpdlId="_EuPVXvQ0EeuR8o7qyugDXg"/>
        <bpws:variable name="PostCode"
            tibex:xpdlId="_EuPVX_Q0EeuR8o7qyugDXg" type="xsd:string"/>
        <bpws:variable name="PolicyHolderRef"
            tibex:classRef="com.fnoldata.Policyholder" tibex:xpdlId="_EuPVYPQ0EeuR8o7qyugDXg"/>
        <bpws:variable name="PolicyHolder"
            tibex:class="com.fnoldata.Policyholder"
            tibex:classVersion="1" tibex:xpdlId="_EuPVYfQ0EeuR8o7qyugDXg"/>
        <bpws:variable name="SecondName"
            tibex:xpdlId="_EuPVYvQ0EeuR8o7qyugDXg" type="xsd:string"/>
        <bpws:variable name="PolicyRefs" tibex:array="yes"
            tibex:classRef="com.fnoldata.Policy" tibex:xpdlId="_JCVjwPRgEeuR8o7qyugDXg"/>
        <bpws:variable name="Policies" tibex:array="yes"
            tibex:class="com.fnoldata.Policy" tibex:classVersion="1" tibex:xpdlId="_lbFiAPRgEeuR8o7qyugDXg"/>
        <bpws:variable name="Index"
            tibex:xpdlId="_3EH1QPRgEeuR8o7qyugDXg" type="xsd:long"/>
        <bpws:variable name="PolicyRef"
            tibex:classRef="com.fnoldata.Policy" tibex:xpdlId="_BErUMPRhEeuR8o7qyugDXg"/>
        <bpws:variable name="ClaimRefs" tibex:array="yes"
            tibex:classRef="com.fnoldata.Claim" tibex:xpdlId="_fVIa8PRhEeuR8o7qyugDXg"/>
        <bpws:variable name="claimRef"
            tibex:classRef="com.fnoldata.Claim" tibex:xpdlId="_kJycwPRhEeuR8o7qyugDXg"/>
        <bpws:variable name="Claims" tibex:array="yes"
            tibex:class="com.fnoldata.Claim" tibex:classVersion="1" tibex:xpdlId="_sY9doPRhEeuR8o7qyugDXg"/>
        <bpws:variable name="Claim" tibex:class="com.fnoldata.Claim"
            tibex:classVersion="1" tibex:xpdlId="_l8Ay4PRiEeuR8o7qyugDXg"/>
        <bpws:variable name="AddCounterparty"
            tibex:xpdlId="_AidJMPRnEeuR8o7qyugDXg" type="xsd:boolean"/>
    </bpws:variables>
    <bpws:extensions>
        <bpws:extension mustUnderstand="yes" namespace="http://www.tibco.com/bpel/2007/extensions"/>
    </bpws:extensions>
    <bpws:eventHandlers/>
    <bpws:flow name="_BX_flow_7A38cPn3Eeuuh9nQQEuk5Q">
        <bpws:links>
            <bpws:link name="GetClaim to _Aav0IPRmEeuR8o7qyugDXg" tibex:xpdlId="_UWxwcfQ0EeuR8o7qyugDXg"/>
            <bpws:link
                name="_Aav0IPRmEeuR8o7qyugDXg to _KDsrYPRmEeuR8o7qyugDXg" tibex:xpdlId="_KDtScPRmEeuR8o7qyugDXg"/>
            <bpws:link name="Start to FindPolicyHolder" tibex:xpdlId="_dqCqwfRkEeuR8o7qyugDXg"/>
            <bpws:link
                name="_KDsrYPRmEeuR8o7qyugDXg to DisplayandUpdateClaim" tibex:xpdlId="_umnOsfRmEeuR8o7qyugDXg"/>
            <bpws:link name="_KDsrYPRmEeuR8o7qyugDXg to AddCounterParty" tibex:xpdlId="_0kKLMPRmEeuR8o7qyugDXg"/>
            <bpws:link name="GetPolicy to GetClaim" tibex:xpdlId="_9fGQcfRnEeuR8o7qyugDXg"/>
            <bpws:link
                name="_LWUJ0fRmEeuR8o7qyugDXg to ThrowGlobalClaimUpdated" tibex:xpdlId="_kwvc8fQ-EeuR8o7qyugDXg"/>
            <bpws:link name="UpdateClaim to _LWUJ0fRmEeuR8o7qyugDXg" tibex:xpdlId="_vfG88PRmEeuR8o7qyugDXg"/>
            <bpws:link name="FindPolicyHolder to GetPolicy" tibex:xpdlId="_iFVxYPRkEeuR8o7qyugDXg"/>
            <bpws:link name="ThrowGlobalClaimUpdated to EndEvent" tibex:xpdlId="_zK1TgPQ0EeuR8o7qyugDXg"/>
            <bpws:link name="DisplayandUpdateClaim to UpdateClaim" tibex:xpdlId="_cEMVA_RpEeuR8o7qyugDXg"/>
            <bpws:link name="AddCounterParty to _LWUJ0fRmEeuR8o7qyugDXg" tibex:xpdlId="_1TQs4PRmEeuR8o7qyugDXg"/>
        </bpws:links>
        <bpws:extensionActivity>
            <tibex:receiveEvent createInstance="yes" eventTimeout="0"
                name="Start" tibex:type="startEvent"
                tibex:xpdlId="_EuPVWPQ0EeuR8o7qyugDXg" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:sources>
                    <bpws:source linkName="Start to FindPolicyHolder"/>
                </bpws:sources>
                <tibex:eventSource>
                    <tibex:startEvent eventType="Default"/>
                </tibex:eventSource>
            </tibex:receiveEvent>
        </bpws:extensionActivity>
        <bpws:scope name="GetPolicy" tibex:type="reusableSubProcess" tibex:xpdlId="_KufAgPQ0EeuR8o7qyugDXg">
            <bpws:targets>
                <bpws:target linkName="FindPolicyHolder to GetPolicy"/>
            </bpws:targets>
            <bpws:sources>
                <bpws:source linkName="GetPolicy to GetClaim"/>
            </bpws:sources>
            <bpws:sequence name="_BX_sequence">
                <bpws:extensionActivity>
                    <tibex:extActivity name="_BX_SPInput_GetPolicy" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                        <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Map from 'PolicyHolderRef' to 'PolicyHolderRef'
if (data != null) {
    parameters.PolicyHolderRef = data.PolicyHolderRef;
} else {
    parameters.PolicyHolderRef = null;
}


]]></tibex:script>
                    </tibex:extActivity>
                </bpws:extensionActivity>
                <bpws:extensionActivity>
                    <tibex:extActivity name="GetPolicy" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                        <tibex:callProcess followParentLifecycle="yes"
                            priority="inline" subProcessId="_xSwVoPX3EeuVSY3wUmTw-w"/>
                    </tibex:extActivity>
                </bpws:extensionActivity>
                <bpws:extensionActivity>
                    <tibex:extActivity name="_BX_SPOutput_GetPolicy" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                        <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Map from 'PolicyRef' to 'PolicyRef'
if (parameters != null) {
    data.PolicyRef = parameters.PolicyRef;
} else {
    data.PolicyRef = null;
}


]]></tibex:script>
                    </tibex:extActivity>
                </bpws:extensionActivity>
            </bpws:sequence>
        </bpws:scope>
        <bpws:extensionActivity>
            <tibex:extActivity name="DisplayandUpdateClaim"
                tibex:type="userTask"
                tibex:xpdlId="_nj_zQPQ0EeuR8o7qyugDXg" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:targets>
                    <bpws:target linkName="_KDsrYPRmEeuR8o7qyugDXg to DisplayandUpdateClaim"/>
                </bpws:targets>
                <bpws:sources>
                    <bpws:source linkName="DisplayandUpdateClaim to UpdateClaim"/>
                </bpws:sources>
                <model:PageActivityDataModelType xmi:version="2.0"
                    xmlns:model="http://model.pageactivity.n2.tibco.com" xmlns:xmi="http://www.omg.org/XMI">
                    <pageActivityParameters>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="Claim"/>
                    </pageActivityParameters>
                </model:PageActivityDataModelType>
            </tibex:extActivity>
        </bpws:extensionActivity>
        <bpws:empty name="EndEvent" tibex:type="endEvent" tibex:xpdlId="_x_cecPQ0EeuR8o7qyugDXg">
            <bpws:targets>
                <bpws:target linkName="ThrowGlobalClaimUpdated to EndEvent"/>
            </bpws:targets>
        </bpws:empty>
        <bpws:extensionActivity>
            <tibex:extActivity name="ThrowGlobalClaimUpdated"
                tibex:type="throwSignalIntermediateEvent"
                tibex:xpdlId="_kwvc8PQ-EeuR8o7qyugDXg" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:targets>
                    <bpws:target linkName="_LWUJ0fRmEeuR8o7qyugDXg to ThrowGlobalClaimUpdated"/>
                </bpws:targets>
                <bpws:sources>
                    <bpws:source linkName="ThrowGlobalClaimUpdated to EndEvent"/>
                </bpws:sources>
                <tibex:GlobalSignal
                    appName="com.example.fnolglobalsignals"
                    appVersion="1" name="FNOLGlobalSignals.gsd#ClaimUpdated"/>
                <tibex:GlobalSignalMappings>
                    <tibex:signalVariables>
                        <bpws:variables>
                            <bpws:variable name="SIGNAL_ClaimId" type="xsd:string"/>
                            <bpws:variable name="SIGNAL_Claim"
                                tibex:class="com.fnoldata.Claim" tibex:classVersion="1"/>
                        </bpws:variables>
                    </tibex:signalVariables>
                    <tibex:correlationCopy/>
                    <tibex:variableCopy/>
                    <tibex:mappingScript expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Map from 'Claim.claimId' to 'ClaimId'
if (data != null && data.Claim != null) {
    SIGNAL_ClaimId = data.Claim.claimId;
} else {
    SIGNAL_ClaimId = null;
}

// Map from 'Claim' to 'Claim'
if (data != null) {
    SIGNAL_Claim = data.Claim;
} else {
    SIGNAL_Claim = null;
}


]]></tibex:mappingScript>
                </tibex:GlobalSignalMappings>
            </tibex:extActivity>
        </bpws:extensionActivity>
        <bpws:scope name="FindPolicyHolder"
            tibex:type="reusableSubProcess" tibex:xpdlId="_dqCqwPRkEeuR8o7qyugDXg">
            <bpws:targets>
                <bpws:target linkName="Start to FindPolicyHolder"/>
            </bpws:targets>
            <bpws:sources>
                <bpws:source linkName="FindPolicyHolder to GetPolicy"/>
            </bpws:sources>
            <bpws:sequence name="_BX_sequence_2">
                <bpws:extensionActivity>
                    <tibex:extActivity name="FindPolicyHolder" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                        <tibex:callProcess followParentLifecycle="yes"
                            priority="inline" subProcessId="__O1ZgvX4EeuVSY3wUmTw-w"/>
                    </tibex:extActivity>
                </bpws:extensionActivity>
                <bpws:extensionActivity>
                    <tibex:extActivity
                        name="_BX_SPOutput_FindPolicyHolder" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                        <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Map from 'PolicyHolderRef' to 'PolicyHolderRef'
if (parameters != null) {
    data.PolicyHolderRef = parameters.PolicyHolderRef;
} else {
    data.PolicyHolderRef = null;
}


]]></tibex:script>
                    </tibex:extActivity>
                </bpws:extensionActivity>
            </bpws:sequence>
        </bpws:scope>
        <bpws:extensionActivity>
            <tibex:extActivity
                name="UpdateClaimDetailsOrAddCounterParty"
                tibex:type="userTask"
                tibex:xpdlId="_Aav0IPRmEeuR8o7qyugDXg" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:targets>
                    <bpws:target linkName="GetClaim to _Aav0IPRmEeuR8o7qyugDXg"/>
                </bpws:targets>
                <bpws:sources>
                    <bpws:source linkName="_Aav0IPRmEeuR8o7qyugDXg to _KDsrYPRmEeuR8o7qyugDXg"/>
                </bpws:sources>
                <model:PageActivityDataModelType xmi:version="2.0"
                    xmlns:model="http://model.pageactivity.n2.tibco.com" xmlns:xmi="http://www.omg.org/XMI">
                    <pageActivityParameters>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="AddCounterparty"/>
                    </pageActivityParameters>
                </model:PageActivityDataModelType>
            </tibex:extActivity>
        </bpws:extensionActivity>
        <bpws:empty name="_BX_gateway__KDsrYPRmEeuR8o7qyugDXg"
            tibex:type="exclusiveGateway" tibex:xpdlId="_KDsrYPRmEeuR8o7qyugDXg">
            <bpws:targets>
                <bpws:target linkName="_Aav0IPRmEeuR8o7qyugDXg to _KDsrYPRmEeuR8o7qyugDXg"/>
            </bpws:targets>
            <bpws:sources tibex:maxTrue="1">
                <bpws:source linkName="_KDsrYPRmEeuR8o7qyugDXg to DisplayandUpdateClaim">
                    <bpws:transitionCondition expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[##otherwise##]]></bpws:transitionCondition>
                </bpws:source>
                <bpws:source linkName="_KDsrYPRmEeuR8o7qyugDXg to AddCounterParty">
                    <bpws:transitionCondition expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[data.AddCounterparty == true;]]></bpws:transitionCondition>
                </bpws:source>
            </bpws:sources>
        </bpws:empty>
        <bpws:empty name="_BX_gateway__LWUJ0fRmEeuR8o7qyugDXg"
            tibex:type="exclusiveGateway" tibex:xpdlId="_LWUJ0fRmEeuR8o7qyugDXg">
            <bpws:targets>
                <bpws:target linkName="UpdateClaim to _LWUJ0fRmEeuR8o7qyugDXg"/>
                <bpws:target linkName="AddCounterParty to _LWUJ0fRmEeuR8o7qyugDXg"/>
            </bpws:targets>
            <bpws:sources>
                <bpws:source linkName="_LWUJ0fRmEeuR8o7qyugDXg to ThrowGlobalClaimUpdated"/>
            </bpws:sources>
        </bpws:empty>
        <bpws:scope name="AddCounterParty"
            tibex:type="reusableSubProcess" tibex:xpdlId="_xqgdgPRmEeuR8o7qyugDXg">
            <bpws:targets>
                <bpws:target linkName="_KDsrYPRmEeuR8o7qyugDXg to AddCounterParty"/>
            </bpws:targets>
            <bpws:sources>
                <bpws:source linkName="AddCounterParty to _LWUJ0fRmEeuR8o7qyugDXg"/>
            </bpws:sources>
            <bpws:sequence name="_BX_sequence_3">
                <bpws:extensionActivity>
                    <tibex:extActivity
                        name="_BX_SPInput_AddCounterParty" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                        <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Map from 'claimRef' to 'ClaimRef'
if (data != null) {
    parameters.ClaimRef = data.claimRef;
} else {
    parameters.ClaimRef = null;
}


]]></tibex:script>
                    </tibex:extActivity>
                </bpws:extensionActivity>
                <bpws:extensionActivity>
                    <tibex:extActivity name="AddCounterParty" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                        <tibex:callProcess followParentLifecycle="yes"
                            priority="inline" subProcessId="_TlYLEPRoEeuR8o7qyugDXg"/>
                    </tibex:extActivity>
                </bpws:extensionActivity>
            </bpws:sequence>
        </bpws:scope>
        <bpws:scope name="GetClaim" tibex:type="reusableSubProcess" tibex:xpdlId="_9fGQcPRnEeuR8o7qyugDXg">
            <bpws:targets>
                <bpws:target linkName="GetPolicy to GetClaim"/>
            </bpws:targets>
            <bpws:sources>
                <bpws:source linkName="GetClaim to _Aav0IPRmEeuR8o7qyugDXg"/>
            </bpws:sources>
            <bpws:sequence name="_BX_sequence_4">
                <bpws:extensionActivity>
                    <tibex:extActivity name="_BX_SPInput_GetClaim" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                        <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Map from 'PolicyRef' to 'PolicyRef'
if (data != null) {
    parameters.PolicyRef = data.PolicyRef;
} else {
    parameters.PolicyRef = null;
}


]]></tibex:script>
                    </tibex:extActivity>
                </bpws:extensionActivity>
                <bpws:extensionActivity>
                    <tibex:extActivity name="GetClaim" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                        <tibex:callProcess followParentLifecycle="yes"
                            priority="inline" subProcessId="_ep7ZUPX3EeuVSY3wUmTw-w"/>
                    </tibex:extActivity>
                </bpws:extensionActivity>
                <bpws:extensionActivity>
                    <tibex:extActivity name="_BX_SPOutput_GetClaim" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                        <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Map from 'Claim' to 'Claim'
if (parameters != null) {
    data.Claim = parameters.Claim;
} else {
    data.Claim = null;
}

// Map from 'ClaimRef' to 'claimRef'
if (parameters != null) {
    data.claimRef = parameters.ClaimRef;
} else {
    data.claimRef = null;
}


]]></tibex:script>
                    </tibex:extActivity>
                </bpws:extensionActivity>
            </bpws:sequence>
        </bpws:scope>
        <bpws:extensionActivity>
            <tibex:extActivity name="UpdateClaim"
                tibex:type="serviceTask"
                tibex:xpdlId="_cEMVAPRpEeuR8o7qyugDXg" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:targets>
                    <bpws:target linkName="DisplayandUpdateClaim to UpdateClaim"/>
                </bpws:targets>
                <bpws:sources>
                    <bpws:source linkName="UpdateClaim to _LWUJ0fRmEeuR8o7qyugDXg"/>
                </bpws:sources>
                <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[data.claimRef = bpm.caseData.updateByRef(data.claimRef,data.Claim);]]></tibex:script>
            </tibex:extActivity>
        </bpws:extensionActivity>
    </bpws:flow>
</bpws:process>
