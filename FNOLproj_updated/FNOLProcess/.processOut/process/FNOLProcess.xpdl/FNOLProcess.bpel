<?xml version="1.0" encoding="UTF-8"?>
<bpws:process exitOnStandardFault="no" name="FNOLProcess"
    suppressJoinFailure="yes" tibex:bxVersion="11.0.0"
    tibex:dataFieldDescriptorClass="com.example.fnolprocess.FNOLProcess.FNOLProcess"
    tibex:dataFieldDescriptorScript="process-js/FNOLProcess/FNOLProcess/FNOLProcess.js"
    tibex:explicitCompensation="yes"
    tibex:xpdlId="_eQ3iYPQxEeuR8o7qyugDXg"
    xmlns:bpws="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:tibex="http://www.tibco.com/bpel/2007/extensions" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <tibex:VariableDescriptor type="PersistentBatching">
        <task name="_BX_SPInput_TriggerFraudCheck">
            <startingVariables>
                <variable>OriginalClaim</variable>
                <variable>UpdatedClaim</variable>
            </startingVariables>
        </task>
        <task name="TriggerFraudCheck">
            <ProcessManagerScript type="Precondition">
                <variable>OriginalClaim</variable>
                <variable>UpdatedClaim</variable>
            </ProcessManagerScript>
        </task>
        <task name="InitialClaimevaluation">
            <startingVariables>
                <variable>Claim</variable>
            </startingVariables>
        </task>
        <task name="SetUpCorrelationData">
            <startingVariables>
                <variable>ClaimId</variable>
                <variable>Claim</variable>
                <variable>claimRef</variable>
                <variable>OriginalClaim</variable>
                <variable>UpdatedClaim</variable>
            </startingVariables>
        </task>
    </tibex:VariableDescriptor>
    <bpws:documentation>*** Generated by TIBCO Business Studio.</bpws:documentation>
    <bpws:variables>
        <bpws:variable name="claimRef"
            tibex:classRef="com.fnoldata.Claim" tibex:parameter="in" tibex:xpdlId="_SKuS8PjyEeubGpJIKV_AxA"/>
        <bpws:variable name="Claim" tibex:class="com.fnoldata.Claim"
            tibex:classVersion="1" tibex:xpdlId="_mnlYsPjyEeubGpJIKV_AxA"/>
        <bpws:variable name="ClaimId"
            tibex:xpdlId="_5S7dgPjyEeubGpJIKV_AxA" type="xsd:string"/>
        <bpws:variable name="UpdatedClaim"
            tibex:class="com.fnoldata.Claim" tibex:classVersion="1" tibex:xpdlId="_jiYKMPkREeubGpJIKV_AxA"/>
        <bpws:variable name="OriginalClaim"
            tibex:class="com.fnoldata.Claim" tibex:classVersion="1" tibex:xpdlId="_RtzbsPkZEeubGpJIKV_AxA"/>
    </bpws:variables>
    <bpws:extensions>
        <bpws:extension mustUnderstand="yes" namespace="http://www.tibco.com/bpel/2007/extensions"/>
    </bpws:extensions>
    <bpws:eventHandlers>
        <tibex:onReceiveEvent name="_BX_AdHoc_TriggerFraudCheck">
            <tibex:eventSource>
                <tibex:AdhocEvent automatic="true" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                    <preConditionExpression
                        language="urn:tibco:wsbpel:2.0:sublang:javascript" text="data.UpdatedClaim.claimamount > (data.OriginalClaim.claimamount * 1.2);"/>
                </tibex:AdhocEvent>
            </tibex:eventSource>
            <bpws:scope name="TriggerFraudCheck"
                tibex:type="reusableSubProcess" tibex:xpdlId="_Q5lqIPkREeubGpJIKV_AxA">
                <bpws:sequence name="_BX_sequence">
                    <bpws:extensionActivity>
                        <tibex:extActivity
                            name="_BX_SPInput_TriggerFraudCheck" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                            <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Map from 'OriginalClaim' to 'OriginalClaim'
if (data != null) {
    parameters.OriginalClaim = data.OriginalClaim;
} else {
    parameters.OriginalClaim = null;
}

// Map from 'UpdatedClaim' to 'UpdateClaim'
if (data != null) {
    parameters.UpdateClaim = data.UpdatedClaim;
} else {
    parameters.UpdateClaim = null;
}


]]></tibex:script>
                        </tibex:extActivity>
                    </bpws:extensionActivity>
                    <bpws:extensionActivity>
                        <tibex:extActivity name="TriggerFraudCheck" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                            <tibex:callProcess
                                followParentLifecycle="yes"
                                priority="inline" subProcessId="_Icda4PQxEeuR8o7qyugDXg"/>
                        </tibex:extActivity>
                    </bpws:extensionActivity>
                </bpws:sequence>
            </bpws:scope>
        </tibex:onReceiveEvent>
        <tibex:onReceiveEvent name="_BX_CatchGlobalClaimUpdated__"
            pauseMainFlow="yes" tibex:blockUntilCompleted="yes"
            tibex:delayedStart="yes" tibex:xpdlId="_YaL7UPjxEeubGpJIKV_AxA">
            <tibex:GlobalSignalMappings>
                <tibex:signalVariables>
                    <bpws:variables>
                        <bpws:variable name="SIGNAL_ClaimId" type="xsd:string"/>
                        <bpws:variable name="SIGNAL_Claim"
                            tibex:class="com.fnoldata.Claim" tibex:classVersion="1"/>
                    </bpws:variables>
                </tibex:signalVariables>
                <tibex:correlationCopy>
                    <bpws:copy>
                        <bpws:from variable="SIGNAL_ClaimId"/>
                        <bpws:to variable="ClaimId"/>
                    </bpws:copy>
                </tibex:correlationCopy>
                <tibex:variableCopy/>
                <tibex:mappingScript expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Map from 'Claim' to 'UpdatedClaim'
data.UpdatedClaim = SIGNAL_Claim;


]]></tibex:mappingScript>
            </tibex:GlobalSignalMappings>
            <tibex:eventSource>
                <tibex:GlobalSignal
                    appName="com.example.fnolglobalsignals"
                    appVersion="1" name="FNOLGlobalSignals.gsd#ClaimUpdated"/>
            </tibex:eventSource>
            <bpws:scope name="_BX_scope__YaL7UPjxEeubGpJIKV_AxA">
                <bpws:flow name="EventSubProcess"
                    tibex:type="eventSubProcess" tibex:xpdlId="_zFfVwPjwEeubGpJIKV_AxA">
                    <bpws:links>
                        <bpws:link
                            name="Throwclaimupdate to _BX_un-named" tibex:xpdlId="_37ZfUPjxEeubGpJIKV_AxA"/>
                        <bpws:link
                            name="CatchGlobalClaimUpdated to Throwclaimupdate" tibex:xpdlId="_Z-uQMPjxEeubGpJIKV_AxA"/>
                    </bpws:links>
                    <bpws:extensionActivity>
                        <tibex:extActivity name="Throwclaimupdate"
                            tibex:type="throwSignalIntermediateEvent"
                            tibex:xpdlId="_3_g_wPjwEeubGpJIKV_AxA" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                            <bpws:targets>
                                <bpws:target linkName="CatchGlobalClaimUpdated to Throwclaimupdate"/>
                            </bpws:targets>
                            <bpws:sources>
                                <bpws:source linkName="Throwclaimupdate to _BX_un-named"/>
                            </bpws:sources>
                            <tibex:signal event="claimupdate">
                                <tibex:variables>
                                    <tibex:variable>UpdatedClaim</tibex:variable>
                                </tibex:variables>
                            </tibex:signal>
                        </tibex:extActivity>
                    </bpws:extensionActivity>
                    <bpws:assign name="CatchGlobalClaimUpdated"
                        tibex:type="signalStartEvent"
                        tibex:useGlobalSignalMapping="yes"
                        tibex:xpdlId="_YaL7UPjxEeubGpJIKV_AxA" validate="no">
                        <bpws:sources>
                            <bpws:source linkName="CatchGlobalClaimUpdated to Throwclaimupdate"/>
                        </bpws:sources>
                    </bpws:assign>
                    <bpws:empty name="_BX_un-named"
                        tibex:type="endEvent" tibex:xpdlId="_3MjcUPjxEeubGpJIKV_AxA">
                        <bpws:targets>
                            <bpws:target linkName="Throwclaimupdate to _BX_un-named"/>
                        </bpws:targets>
                    </bpws:empty>
                </bpws:flow>
            </bpws:scope>
        </tibex:onReceiveEvent>
    </bpws:eventHandlers>
    <bpws:flow name="_BX_flow_7FFuEPn3Eeuuh9nQQEuk5Q">
        <bpws:links>
            <bpws:link name="StartEvent to SetUpCorrelationData" tibex:xpdlId="_lW1X8PjxEeubGpJIKV_AxA"/>
            <bpws:link name="InitialClaimevaluation to EndEvent" tibex:xpdlId="_eQ5-pPQxEeuR8o7qyugDXg"/>
            <bpws:link
                name="SetUpCorrelationData to InitialClaimevaluation" tibex:xpdlId="_lTmKE_X5EeuVSY3wUmTw-w"/>
        </bpws:links>
        <bpws:extensionActivity>
            <tibex:receiveEvent createInstance="yes" eventTimeout="0"
                name="StartEvent" tibex:type="startEvent"
                tibex:xpdlId="_eQ5-ovQxEeuR8o7qyugDXg" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:sources>
                    <bpws:source linkName="StartEvent to SetUpCorrelationData"/>
                </bpws:sources>
                <tibex:parameters>
                    <parameterDescription mandatory="yes" mode="In" name="claimRef"/>
                </tibex:parameters>
                <tibex:eventSource>
                    <tibex:startEvent eventType="Default"/>
                </tibex:eventSource>
            </tibex:receiveEvent>
        </bpws:extensionActivity>
        <bpws:empty name="EndEvent" tibex:migrationAllowed="yes"
            tibex:type="endEvent" tibex:xpdlId="_eQ5-o_QxEeuR8o7qyugDXg">
            <bpws:targets>
                <bpws:target linkName="InitialClaimevaluation to EndEvent"/>
            </bpws:targets>
        </bpws:empty>
        <bpws:extensionActivity>
            <tibex:extActivity name="InitialClaimevaluation"
                tibex:migrationAllowed="yes" tibex:type="userTask"
                tibex:xpdlId="_lTmKEPX5EeuVSY3wUmTw-w" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:targets>
                    <bpws:target linkName="SetUpCorrelationData to InitialClaimevaluation"/>
                </bpws:targets>
                <bpws:sources>
                    <bpws:source linkName="InitialClaimevaluation to EndEvent"/>
                </bpws:sources>
                <model:UserTaskDataModelType
                    distributionStrategy="OFFER" userTaskPriority="50"
                    workModelID="WM__lTmKEPX5EeuVSY3wUmTw-w"
                    workModelVersionRange="[1.0.0.qualifier,1.0.0.qualifier]"
                    xmi:version="2.0"
                    xmlns:model="http://model.ut.n2.tibco.com" xmlns:xmi="http://www.omg.org/XMI">
                    <userTaskParticipants>
                        <userTaskParticipant
                            entity="ORGANIZATIONAL_QUERY" rqlQuery="resource(name=&quot;tibco-admin&quot;)&#xd;&#xa;"/>
                    </userTaskParticipants>
                    <userTaskParameters>
                        <userTaskParameter mandatory="false" mode="IN" name="Claim"/>
                    </userTaskParameters>
                    <userTaskGroupMemberships/>
                </model:UserTaskDataModelType>
                <tibex:signalUpdateEvent event="claimupdate">
                    <tibex:signalVariables>
                        <bpws:variables>
                            <bpws:variable name="UpdatedClaim"
                                tibex:class="com.fnoldata.Claim" tibex:classVersion="1"/>
                        </bpws:variables>
                    </tibex:signalVariables>
                    <tibex:updateVariables>
                        <bpws:variables>
                            <bpws:variable name="Claim"
                                tibex:class="com.fnoldata.Claim" tibex:classVersion="1"/>
                        </bpws:variables>
                    </tibex:updateVariables>
                    <tibex:mappingScript expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Map from 'UpdatedClaim' to 'Claim'
data.Claim = SIGNAL_UpdatedClaim;


]]></tibex:mappingScript>
                </tibex:signalUpdateEvent>
            </tibex:extActivity>
        </bpws:extensionActivity>
        <bpws:extensionActivity>
            <tibex:extActivity name="SetUpCorrelationData"
                tibex:arm="_Q5lqIPkREeubGpJIKV_AxA,_YaL7UPjxEeubGpJIKV_AxA"
                tibex:migrationAllowed="yes" tibex:type="scriptTask"
                tibex:xpdlId="_lW0w4PjxEeubGpJIKV_AxA" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:targets>
                    <bpws:target linkName="StartEvent to SetUpCorrelationData"/>
                </bpws:targets>
                <bpws:sources>
                    <bpws:source linkName="SetUpCorrelationData to InitialClaimevaluation"/>
                </bpws:sources>
                <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[data.Claim = bpm.caseData.read(data.claimRef);
data.UpdatedClaim = data.Claim;
data.OriginalClaim = data.Claim;
data.ClaimId = data.Claim.claimId;

]]></tibex:script>
            </tibex:extActivity>
        </bpws:extensionActivity>
    </bpws:flow>
</bpws:process>
